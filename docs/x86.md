# x86

### 标准 IRQ 定义

PC-AT 使用两片级联的 i8259 PIC。

0. PIT 可编程时钟（8253、8254）
1. 键盘
2. 关联第二级中断控制器
3. COM2
4. COM1
5. LPT2
6. 软盘
7. LPT1，或者 spurious interrupt
8. CMOS 实时时钟
9. free for peripherals / legacy SCSI / NIC
10. free for peripherals / SCSI / NIC
11. free for peripherals / SCSI / NIC
12. PS2 鼠标
13. FPU、协处理器、处理器间通信
14. primary ATA
15. secondary ATA

### 触发模式

边沿触发还是电平触发，上升沿还是下降沿，高电平触发还是低电平触发？

只有用到的中断才需要正确设置触发模式，用不到的暂时不重要。

根据 8259A datasheet，两种 trigger mode 都支持，通过 ICW1 bit 3 控制。
示例代码用的是默认的 edge-trigger，应该这就是默认触发模式。

根据 [IBM AIX 文档](https://www.ibm.com/docs/en/aix/7.2?topic=interrupts-interrupt-trigger)：
- ISA 中断都是边沿触发
- PCI/PCIe 中断分为两种：
    - LSI，Level Signalled Interrupt，电平触发
    - MSI，Message Signalled Interrupt，边沿触发

根据 osdev 论坛上 [Brendan 的回复](https://forum.osdev.org/viewtopic.php?p=280231&sid=d75492de6f2ffabe2bc4a4cdbc5590e0#p280231)：
legacy IRQ 使用 ISA Signalling，也就是 edge-trigger，active-high。对于边沿，active-high 指的是上升沿触发。


这一点资料很少，需要知道默认配置是什么

参考资料：《IBM PC/AT Technical Reference》

### NMI

NMI 比较特殊，其用途并不确定。

某些服务器上有[实体 NMI 按钮](./nmi.png)，由于 NMI 不可屏蔽，这个按钮可以在系统卡死时让系统重置。

另一些机器上 NMI 连接到看门狗，只要喂狗不及时，NMI 就会自动触发，相当于自动按下 NMI 按钮。

当然，这只是 NMI 的用途，要发挥作用需要 OS 支持。
