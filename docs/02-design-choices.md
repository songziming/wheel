# 一些设计取舍

### 划分内存布局

决定以下区域在内存中的位置：
- 内核代码数据
- 启动阶段申请占用的内存（重要数据结构备份、framebuf 离屏缓冲区）
- 页描述符数组
- PCPU 区域（多份）

这些内存编译时大小未知，必须启动后确定位置和大小。

相邻 range 之间可以留有 guard page，虚拟地址空间不映射，如果访问越界能立即发现。

### 记录 mem_range、内存对齐

启动阶段划分内存区域，因为缓存和安全，每一段内存有不同的对齐要求。
因为对齐的存在，相邻两段 range 中间可能有 gap-page。
中间的 gap-page，可以把物理页回收，虚拟页标记为 invalid。

既然要对齐，就要把整齐的内存放在一起，零碎的内存放在一起。这就导致，相同用途的内存要分两次申请。
